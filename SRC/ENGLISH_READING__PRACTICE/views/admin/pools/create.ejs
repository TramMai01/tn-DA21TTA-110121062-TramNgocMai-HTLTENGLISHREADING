<div class="container mx-auto px-4 py-8">
  <div class="flex justify-between items-center mb-6">
    <h1 class="text-3xl font-bold text-gray-800">Create Test Pool</h1>
    <a href="/admin/pools" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-md transition duration-200 flex items-center">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
        <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd" />
      </svg>
      Back to Pools
    </a>
  </div>
  
  <div class="bg-white rounded-lg shadow-md p-6 mb-8">
    <% if (locals.error) { %>
      <div class="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-4" role="alert">
        <p class="font-medium">Error:</p>
        <p><%= error %></p>
      </div>
    <% } %>
    
    <div class="bg-blue-50 border-l-4 border-blue-400 p-4 mb-6">
      <div class="flex">
        <div class="flex-shrink-0">
          <svg class="h-5 w-5 text-blue-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" />
          </svg>
        </div>
        <div class="ml-3">
          <p class="text-sm text-blue-700">
            <strong class="font-medium">Thông tin quan trọng:</strong> Test pool cho phép bạn tạo một nhóm các bài kiểm tra hoặc thiết lập tiêu chí để hệ thống tự động tạo bài kiểm tra ngẫu nhiên từ bài đọc và câu hỏi.
          </p>
        </div>
      </div>
    </div>
    
    <form action="/admin/pools/create" method="POST" class="space-y-6">
      <!-- Pool Name -->
      <div>
        <label for="name" class="block text-sm font-medium text-gray-700 mb-1">Tên Test Pool <span class="text-red-500">*</span></label>
        <input 
          type="text" 
          id="name" 
          name="name" 
          required
          placeholder="Nhập tên mô tả cho test pool này"
          class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
        >
      </div>
      
      <!-- Pool Type Selection -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-3">Loại Test Pool</label>
        <div class="bg-gray-50 p-4 rounded-md">
          <div class="flex flex-col gap-4">
            <div>
              <label class="inline-flex items-center">
                <input type="radio" name="poolType" value="specific" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded" checked>
                <span class="ml-2 text-gray-700">Chọn Test Cụ thể - Chọn các bài kiểm tra cụ thể để đưa vào nhóm</span>
              </label>
            </div>
            <div>
              <label class="inline-flex items-center">
                <input type="radio" name="poolType" value="criteria" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                <span class="ml-2 text-gray-700">Tiêu chí Lựa chọn - Xác định tiêu chí để tạo bài kiểm tra ngẫu nhiên từ các bài đọc và câu hỏi</span>
              </label>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Specific Tests Section -->
      <div id="specific-tests-section" class="p-5 border border-gray-200 rounded-md">
        <h3 class="text-lg font-medium text-gray-800 mb-4">Chọn Bài Kiểm Tra</h3>
        
        <% if (tests && tests.length > 0) { %>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 max-h-96 overflow-y-auto p-2">
            <% tests.forEach(test => { %>
              <div class="flex items-center space-x-3 p-3 border border-gray-200 rounded-md hover:bg-gray-50">
                <input 
                  type="checkbox" 
                  id="test-<%= test._id %>" 
                  name="tests" 
                  value="<%= test._id %>"
                  class="h-5 w-5 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"
                >
                <label for="test-<%= test._id %>" class="flex-1 text-sm text-gray-700">
                  <div class="flex flex-col">
                    <strong><%= test.title %></strong>
                    <div class="flex items-center mt-1 space-x-2">
                      <span class="text-xs px-2 py-1 rounded-full bg-gray-200 text-gray-700"><%= test.timeLimit %> phút</span>
                      <% if (test.difficulty) { %>
                        <span class="text-xs px-2 py-1 rounded-full 
                          <%= test.difficulty === 'easy' ? 'bg-green-100 text-green-800' : 
                            test.difficulty === 'medium' ? 'bg-yellow-100 text-yellow-800' : 
                            'bg-red-100 text-red-800' %>">
                          <%= test.difficulty.charAt(0).toUpperCase() + test.difficulty.slice(1) %>
                        </span>
                      <% } %>
                    </div>
                  </div>
                </label>
              </div>
            <% }); %>
          </div>
        <% } else { %>
          <div class="text-center py-8 text-gray-500">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mx-auto text-gray-400 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            <p>Không có bài kiểm tra nào. Vui lòng tạo bài kiểm tra trước.</p>
            <a href="/admin/tests/create" class="text-blue-600 hover:text-blue-500 mt-4 inline-block font-medium">
              Tạo Bài Kiểm Tra Mới
            </a>
          </div>
        <% } %>
      </div>
      
      <!-- Criteria Selection Section -->
      <div id="criteria-section" class="p-5 border border-gray-200 rounded-md hidden">
        <h3 class="text-lg font-medium text-gray-800 mb-4">Xác định Tiêu chí Tạo Đề</h3>
        
        <!-- Passage Count -->
        <div class="mb-4">
          <label for="passageCount" class="block text-sm font-medium text-gray-700 mb-1">Số lượng bài đọc</label>
          <input 
            type="number" 
            id="passageCount" 
            name="criteria[passageCount]" 
            min="1"
            max="5"
            value="1"
            class="w-full md:w-1/4 px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
          >
          <p class="mt-1 text-xs text-gray-500">Số lượng bài đọc sẽ được chọn ngẫu nhiên cho mỗi đề thi</p>
        </div>
        
        <!-- Question Count -->
        <div class="mb-4">
          <label for="questionCount" class="block text-sm font-medium text-gray-700 mb-1">Số lượng câu hỏi mỗi bài đọc</label>
          <input 
            type="number" 
            id="questionCount" 
            name="criteria[questionCount]" 
            min="1"
            max="10"
            value="5"
            class="w-full md:w-1/4 px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
          >
          <p class="mt-1 text-xs text-gray-500">Số lượng câu hỏi tối đa cho mỗi bài đọc</p>
        </div>
        
        <!-- Question Types -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Loại Câu Hỏi (chọn ít nhất một)</label>
          <p class="text-xs text-gray-500 mb-3">Nếu không chọn, hệ thống sẽ sử dụng tất cả các loại câu hỏi</p>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
            <% questionTypes.forEach(type => { %>
              <div>
                <label class="inline-flex items-center">
                  <input type="checkbox" name="criteria[questionTypes]" value="<%= type %>" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                  <span class="ml-2 text-gray-700">
                    <% if (type === 'multiple_choice') { %>
                      Trắc nghiệm
                    <% } else if (type === 'fill_blank') { %>
                      Điền vào chỗ trống
                    <% } else if (type === 'matching') { %>
                      Nối
                    <% } else if (type === 'true_false_not_given') { %>
                      Đúng/Sai/Không đề cập
                    <% } else { %>
                      <%= type %>
                    <% } %>
                  </span>
                </label>
              </div>
            <% }); %>
          </div>
        </div>
      </div>
      
      <!-- Submit Button -->
      <div class="flex justify-end">
        <button 
          type="submit" 
          class="bg-blue-500 hover:bg-blue-600 text-white font-medium py-2 px-6 rounded-md transition duration-200"
        >
          Tạo Test Pool
        </button>
      </div>
    </form>
  </div>
</div>
<% scripts = `<script src="/js/admin/pools/create.js"></script>` %>
