<div class="container mx-auto px-4 py-8">
  <div class="flex justify-between items-center mb-6">
    <h1 class="text-3xl font-bold text-gray-800">Test Pools</h1>
    <a href="/admin/pools/create" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-md transition duration-200 flex items-center">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
        <path fill-rule="evenodd" d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z" clip-rule="evenodd" />
      </svg>
      Tạo Test Pool Mới
    </a>
  </div>
  
  <div class="bg-white rounded-lg shadow-md p-6 mb-8">
    <h2 class="text-xl font-semibold text-gray-800 mb-4">Test Pool là gì?</h2>
    <p class="text-gray-600 mb-4">
      Test Pool cho phép bạn tạo một nhóm các bài kiểm tra hoặc thiết lập tiêu chí để hệ thống tự động tạo bài kiểm tra ngẫu nhiên từ bài đọc và câu hỏi. 
      Điều này giúp bạn tiết kiệm thời gian biên soạn đề thi và tạo ra sự đa dạng trong các bài kiểm tra.
    </p>
    <div class="bg-blue-50 border-l-4 border-blue-400 p-4">
      <div class="flex">
        <div class="flex-shrink-0">
          <svg class="h-5 w-5 text-blue-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" />
          </svg>
        </div>
        <div class="ml-3">
          <p class="text-sm text-blue-700">
            <strong>Mẹo:</strong> Bạn có thể tạo Test Pool theo hai cách: (1) Chọn các bài kiểm tra có sẵn hoặc (2) Xác định tiêu chí để hệ thống tự động tạo đề ngẫu nhiên từ các bài đọc và câu hỏi.
          </p>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Test Pools List -->
  <div class="bg-white rounded-lg shadow overflow-hidden">
    <% if (pools && pools.length > 0) { %>
      <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
          <tr>
            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
              Tên Pool
            </th>
            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
              Đề Có Sẵn
            </th>
            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
              Tiêu Chí Tạo Đề
            </th>
            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
              Người Tạo
            </th>
            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
              Thao Tác
            </th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
          <% pools.forEach(pool => { %>
            <tr>
              <td class="px-6 py-4 whitespace-nowrap">
                <div class="text-sm font-medium text-gray-900">
                  <%= pool.name %>
                </div>
                <div class="text-xs text-gray-500">
                  Tạo ngày <%= new Date(pool.createdAt).toLocaleDateString() %>
                </div>
              </td>
              <td class="px-6 py-4">
                <% if (pool.tests && pool.tests.length > 0) { %>
                  <div class="flex flex-wrap gap-1">
                    <% pool.tests.slice(0, 3).forEach(test => { %>
                      <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                        <%= typeof test === 'object' ? test.title : 'Test' %>
                      </span>
                    <% }); %>
                    <% if (pool.tests.length > 3) { %>
                      <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                        +<%= pool.tests.length - 3 %> đề khác
                      </span>
                    <% } %>
                  </div>
                <% } else { %>
                  <span class="text-sm text-gray-500">Chưa có đề</span>
                <% } %>
              </td>
              <td class="px-6 py-4">
                <% if (pool.criteria) { %>
                  <div class="space-y-1">
                    <% if (pool.criteria.passageCount) { %>
                      <div class="flex items-center">
                        <span class="text-xs text-gray-500 mr-2">Bài đọc:</span>
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                          <%= pool.criteria.passageCount %>
                        </span>
                      </div>
                    <% } %>
                    
                    <% if (pool.criteria.questionCount) { %>
                      <div class="flex items-center">
                        <span class="text-xs text-gray-500 mr-2">Câu hỏi/bài:</span>
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-orange-100 text-orange-800">
                          <%= pool.criteria.questionCount %>
                        </span>
                      </div>
                    <% } %>
                    
                    <% if (pool.criteria.questionTypes && pool.criteria.questionTypes.length > 0) { %>
                      <div class="flex items-center flex-wrap">
                        <span class="text-xs text-gray-500 mr-2">Loại câu hỏi:</span>
                        <div class="flex flex-wrap gap-1">
                          <% pool.criteria.questionTypes.forEach(type => { %>
                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-indigo-100 text-indigo-800">
                              <% if (type === 'multiple_choice') { %>
                                Trắc nghiệm
                              <% } else if (type === 'fill_blank') { %>
                                Điền chỗ trống
                              <% } else if (type === 'matching') { %>
                                Nối
                              <% } else if (type === 'true_false_not_given') { %>
                                Đúng/Sai
                              <% } else { %>
                                <%= type %>
                              <% } %>
                            </span>
                          <% }); %>
                        </div>
                      </div>
                    <% } %>
                  </div>
                <% } else { %>
                  <span class="text-sm text-gray-500">Không có tiêu chí</span>
                <% } %>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                <%= pool.createdBy?.username || 'Unknown' %>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                <div class="flex space-x-2">
                  <a href="/admin/pools/<%= pool._id %>/generate" class="text-blue-600 hover:text-blue-900 flex items-center" title="Tạo Đề Ngẫu Nhiên">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                    </svg>
                    Tạo đề
                  </a>
                  <button 
                    onclick="deletePool('<%= pool._id %>')" 
                    class="text-red-600 hover:text-red-900 flex items-center" 
                    title="Xóa"
                  >
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                    </svg>
                    Xóa
                  </button>
                </div>
              </td>
            </tr>
          <% }); %>
        </tbody>
      </table>
    <% } else { %>
      <div class="py-16 text-center">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 mx-auto text-gray-400 mb-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />
        </svg>
        <p class="text-gray-500 text-lg mb-4">Chưa có Test Pool nào</p>
        <p class="text-gray-500 mb-6">Tạo Test Pool đầu tiên của bạn để dễ dàng quản lý và tạo đề kiểm tra</p>
        <a href="/admin/pools/create" class="inline-block bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-md transition duration-200 font-medium">
          Tạo Test Pool Mới
        </a>
      </div>
    <% } %>
  </div>
</div>

<!-- Confirmation Modal -->
<div id="confirmationModal" class="fixed inset-0 bg-gray-600 bg-opacity-75 flex items-center justify-center z-50 hidden">
  <div class="bg-white rounded-lg max-w-md w-full p-6 shadow-xl">
    <h3 class="text-lg font-medium text-gray-900 mb-4">Xác nhận xóa</h3>
    <p class="text-gray-500 mb-6">Bạn có chắc chắn muốn xóa Test Pool này? Thao tác này không thể hoàn tác.</p>
    <div class="flex justify-end space-x-3">
      <button id="cancelButton" class="bg-gray-200 hover:bg-gray-300 text-gray-800 px-4 py-2 rounded-md transition duration-200">
        Hủy bỏ
      </button>
      <button id="confirmButton" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-md transition duration-200">
        Xóa
      </button>
    </div>
  </div>
</div>
<% scripts = `<script src="/js/admin/pools/index.js"></script>` %>