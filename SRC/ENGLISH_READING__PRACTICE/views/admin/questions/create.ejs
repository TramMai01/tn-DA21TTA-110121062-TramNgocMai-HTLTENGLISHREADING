<div class="container mx-auto px-4 py-8">
  <% if (locals.success) { %>
    <div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4" role="alert">
      <p><%= success %></p>
    </div>
  <% } %>

  <% if (locals.error) { %>
    <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4" role="alert">
      <p><%= error %></p>
    </div>
  <% } %>

  <div class="flex justify-between items-center mb-6">
    <h1 class="text-3xl font-bold text-gray-800">Create Question</h1>
    <a href="/admin/passages/<%= passage._id %>" class="text-blue-500 hover:text-blue-700 flex items-center">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" viewBox="0 0 20 20" fill="currentColor">
        <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd" />
      </svg>
      Back to Passage
    </a>
  </div>

  <!-- Passage Preview Card -->
  <div class="bg-white rounded-lg shadow-md overflow-hidden mb-8">
    <div class="px-6 py-4 bg-gray-50 border-b border-gray-200">
      <h2 class="text-xl font-semibold text-gray-800">Reading Passage Preview</h2>
      <div class="mt-1 flex items-center">
        <span class="ml-2 text-gray-500 text-sm truncate max-w-md"><%= passage.title %></span>
      </div>
    </div>
    <div class="p-6">
      <div class="prose max-w-none max-h-80 overflow-y-auto passage-content">
        <% 
          // Split content by paragraphs and render
          const paragraphs = passage.content.split(/\n\s*\n/);
        %>
        <% paragraphs.forEach((paragraph, index) => { %>
          <p id="paragraph-<%= index %>" class="mb-4"><%= paragraph %></p>
        <% }); %>
      </div>
    </div>
  </div>

  <!-- Question Form -->
  <div class="bg-white rounded-lg shadow-md overflow-hidden">
    <form action="/admin/passages/<%= passage._id %>/questions/create" method="POST" id="questionForm" class="p-6">
      <% if (locals.error) { %>
        <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4" role="alert">
          <p><%= locals.error %></p>
        </div>
      <% } %>

      <!-- Selected Question Type Indicator -->
      <div id="selectedTypeIndicator" class="hidden mb-6 px-2 py-1 text-sm font-medium rounded-full inline-block"></div>

      <!-- Multiple Choice Settings (NEW SECTION FOR MULTIPLE ANSWERS) -->
      <div id="multipleChoiceSettings" class="hidden mb-6 bg-blue-50 p-4 rounded-md border border-blue-200">
        <h3 class="text-md font-medium text-blue-800 mb-2">Multiple Choice Settings</h3>
        <label class="inline-flex items-center">
          <input type="checkbox" id="multipleAnswersCheckbox" name="multipleAnswers" class="h-4 w-4 text-blue-600 border-gray-300 focus:ring-blue-500">
          <span class="ml-2 text-sm text-gray-700">Allow multiple correct answers</span>
        </label>
        <p class="mt-1 text-sm text-gray-500">Check this box if the question has more than one correct answer (2, 3, 4 answers)</p>
      </div>

      <!-- Basic Question Information -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
        <div>
          <label for="questionType" class="block text-sm font-medium text-gray-700 mb-1">Question Type</label>
          <select 
            id="questionType" 
            name="questionType" 
            class="w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"
            required
          >
            <option value="" selected disabled>Select question type</option>
            <option value="multiple_choice">Multiple Choice</option>
            <option value="fill_blank">Fill in the Blank</option>
            <option value="matching">Matching</option>
            <option value="true_false_not_given">True/False/Not Given</option>
            <option value="short_answer">Short Answer</option>
          </select>
        </div>
        
        <div>
          <label for="order" class="block text-sm font-medium text-gray-700 mb-1">Question Order</label>
          <input 
            type="number" 
            id="order" 
            name="order" 
            min="1" 
            value="<%= nextOrder %>" 
            class="w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"
            required
          >
          <p class="mt-1 text-sm text-gray-500">Order in which this question appears</p>
        </div>
      </div>

      <div class="mb-6">
        <label for="title" class="block text-sm font-medium text-gray-700 mb-1">Question title (optional)</label>
        <textarea 
          id="title" 
          name="title" 
          rows="3"
          placeholder="Enter the question title (optional)" 
          class="w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"
        ></textarea>
        <p class="mt-1 text-sm text-gray-500">Short title for the question (optional, can span multiple lines)</p>
      </div>

      <div class="mb-6">
        <label for="questionText" class="block text-sm font-medium text-gray-700 mb-1">Question Text</label>
        <textarea 
          id="questionText" 
          name="questionText" 
          rows="3" 
          placeholder="Enter the question" 
          class="w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"
          required
        ></textarea>
        <p class="mt-1 text-sm text-gray-500">Try selecting text from the passage to create a question</p>
      </div>

      <div class="mb-6">
        <label for="score" class="block text-sm font-medium text-gray-700 mb-1">Score</label>
        <input 
          type="number" 
          id="score" 
          name="score" 
          min="0.5" 
          step="0.5" 
          value="1" 
          class="w-full max-w-xs rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"
          required
        >
        <p class="mt-1 text-sm text-gray-500">Points awarded for a correct answer</p>
      </div>

      <!-- Multiple Choice Options -->
      <div id="multiple_choiceOptions" class="question-type-section mb-6 hidden">
        <h3 class="text-lg font-medium text-gray-900 mb-3">Multiple Choice Options</h3>
        
        <div id="optionsContainer" class="space-y-3">
          <div class="flex items-center gap-2 mb-2">
            <input type="radio" name="correctAnswer" id="correctAnswer0" value="0" class="h-4 w-4 text-blue-600 border-gray-300 focus:ring-blue-500">
            <input type="text" name="options" placeholder="Option 1" class="flex-1 rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500" oninput="updateInputValue(this)">
            <button type="button" class="text-red-600 hover:text-red-900 remove-option hidden">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
              </svg>
            </button>
          </div>
          <div class="flex items-center gap-2 mb-2">
            <input type="radio" name="correctAnswer" id="correctAnswer1" value="1" class="h-4 w-4 text-blue-600 border-gray-300 focus:ring-blue-500">
            <input type="text" name="options" placeholder="Option 2" class="flex-1 rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500" oninput="updateInputValue(this)">
            <button type="button" class="text-red-600 hover:text-red-900 remove-option hidden">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
              </svg>
            </button>
          </div>
        </div>
        
        <button type="button" id="addOptionBtn" class="mt-3 inline-flex items-center px-3 py-1.5 border border-transparent text-sm font-medium rounded-md text-blue-700 bg-blue-100 hover:bg-blue-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z" clip-rule="evenodd" />
          </svg>
          Add Option
        </button>
      </div>

      <!-- Fill in the Blank Options -->
      <div id="fill_blankOptions" class="question-type-section mb-6 hidden">
        <h3 class="text-lg font-medium text-gray-900 mb-3">Fill in the Blank</h3>
        
        <div class="mb-4">
          <label for="blankStyleSelect" class="block text-sm font-medium text-gray-700 mb-1">Fill in the Blank type</label>
          <select id="blankStyleSelect" name="blankStyle" class="w-full max-w-md rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
            <option value="simple">Simple</option>
            <option value="multiple">Multiple</option>
            <option value="one_word_only">One word only</option>
          </select>
        </div>
        
        <!-- Các container cho từng loại fill blank -->
        <div id="simpleBlankContainer" style="display: block;">
          <div class="mb-4">
            <h4 class="text-md font-medium text-gray-800 mb-2">Acceptable answers</h4>
            <p class="text-sm text-gray-600 mb-2">Add the acceptable answers for the fill in the blank question.</p>
          </div>
          
          <div id="acceptableAnswersContainer" class="space-y-2">
            <!-- First answer (default) -->
            <div class="flex items-center gap-2 mb-2">
              <input type="text" name="acceptableAnswers" placeholder="Acceptable answer 1" class="flex-1 rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
              <button type="button" class="text-red-600 hover:text-red-900 remove-answer hidden">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                  <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
                </svg>
              </button>
            </div>
          </div>
          
          <button type="button" id="addAnswerBtn" class="mt-3 inline-flex items-center px-3 py-1.5 border border-transparent text-sm font-medium rounded-md text-green-700 bg-green-100 hover:bg-green-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z" clip-rule="evenodd" />
            </svg>
            Add another answer
          </button>
        </div>
        
        <div id="multipleBlankContainer" style="display: none;">
          <div class="mb-3">
            <p class="text-sm text-gray-600 mb-2">Add the blanks and select the correct answers:</p>
            <div id="blankOptionsContainer" class="space-y-2">
              <!-- Các tùy chọn sẽ được thêm vào đây bằng JavaScript -->
            </div>
            <button type="button" id="addBlankOptionBtn" class="mt-2 inline-flex items-center px-3 py-1.5 border border-transparent text-sm font-medium rounded-md text-blue-700 bg-blue-100 hover:bg-blue-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z" clip-rule="evenodd" />
              </svg>
              Add option
            </button>
          </div>
          
          <div class="mb-3 mt-4">
            <p class="text-sm text-gray-600 mb-2">Add the blanks and select the correct answers:</p>
            <div id="blanksContainer" class="space-y-2">
              <!-- Các blank sẽ được thêm vào đây bằng JavaScript -->
            </div>
            <button type="button" id="addBlankBtn" class="mt-2 inline-flex items-center px-3 py-1.5 border border-transparent text-sm font-medium rounded-md text-blue-700 bg-blue-100 hover:bg-blue-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z" clip-rule="evenodd" />
              </svg>
              Add blank
            </button>
          </div>
        </div>
        
        <div id="oneWordOnlyContainer" style="display: none;">
          <div class="mb-3">
            <p class="text-sm text-gray-600 mb-2">Add the correct answers for each blank. Each answer can be limited to a certain number of words.</p>
            <div id="oneWordBlanksContainer" class="space-y-2">
              <!-- Các blank sẽ được thêm vào đây bằng JavaScript -->
            </div>
            <button type="button" id="addOneWordBlankBtn" class="mt-2 inline-flex items-center px-3 py-1.5 border border-transparent text-sm font-medium rounded-md text-blue-700 bg-blue-100 hover:bg-blue-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z" clip-rule="evenodd" />
              </svg>
              Add blank
            </button>
          </div>
        </div>
      </div>

      <!-- Matching Options -->
      <div id="matchingOptions" class="question-type-section mb-6 hidden">
        <h3 class="text-lg font-medium text-gray-900 mb-3">Matching Options</h3>
        
        <!-- Thêm phần chọn loại matching -->
        <div class="mb-4">
          <label for="matchingTypeSelect" class="block text-sm font-medium text-gray-700 mb-1">Matching type</label>
          <select 
            id="matchingTypeSelect" 
            name="matchingType" 
            class="w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"
          >
            <option value="one_to_one">One-to-one (each paragraph connects to a single heading)</option>
            <option value="not_all_used">Not all used (some headings may not be used)</option>
            <option value="many_to_one">Many-to-one (multiple paragraphs can connect to the same heading)</option>
          </select>
          <p class="mt-1 text-sm text-gray-500">Select the matching type that suits your question</p>
        </div>
        
        <!-- Phần còn lại giữ nguyên -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
          <!-- Headings -->
          <div>
            <h4 class="text-md font-medium text-gray-800 mb-2">Headings</h4>
            <p class="text-sm text-gray-500 mb-3">Add the headings that students will choose</p>
            
            <div id="headingsContainer" class="space-y-3">
              <!-- Existing headings inputs -->
            </div>
            
            <button type="button" id="addHeadingBtn" class="mt-3 inline-flex items-center px-3 py-1.5 border border-transparent text-sm font-medium rounded-md text-blue-700 bg-blue-100 hover:bg-blue-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z" clip-rule="evenodd" />
              </svg>
              Add Heading
            </button>
          </div>
          
          <!-- Paragraphs -->
          <div>
            <h4 class="text-md font-medium text-gray-800 mb-2">Paragraphs)</h4>
            <p class="text-sm text-gray-500 mb-3">Add the paragraphs that need to be matched</p>
            
            <div id="paragraphsContainer" class="space-y-3">
              <!-- Existing paragraphs inputs -->
            </div>
            
            <button type="button" id="addParagraphBtn" class="mt-3 inline-flex items-center px-3 py-1.5 border border-transparent text-sm font-medium rounded-md text-green-700 bg-green-100 hover:bg-green-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z" clip-rule="evenodd" />
              </svg>
              Add Paragraph
            </button>
          </div>
        </div>
        
        <div class="mt-8">
          <h4 class="text-md font-medium text-gray-800 mb-2">Matching Matrix</h4>
          <p class="text-sm text-gray-500 mb-3">Set the correct answer for each paragraph</p>
          
          <div id="matchingMatrixContainer" class="space-y-3">
            <!-- Will be populated dynamically -->
          </div>
        </div>
      </div>

      <!-- True/False/Not Given Options -->
      <div id="true_false_not_givenOptions" class="question-type-section mb-6 hidden">
        <h3 class="text-lg font-medium text-gray-900 mb-3">Correct Answer</h3>

        <div class="flex space-x-4">
          <div class="flex items-center">
            <input 
              type="radio" 
              id="true" 
              name="correctAnswer" 
              value="true" 
              class="h-4 w-4 text-blue-600 border-gray-300 focus:ring-blue-500"
            >
            <label for="true" class="ml-2 block text-sm text-gray-700">True</label>
          </div>
          <div class="flex items-center">
            <input 
              type="radio" 
              id="false" 
              name="correctAnswer" 
              value="false" 
              class="h-4 w-4 text-blue-600 border-gray-300 focus:ring-blue-500"
            >
            <label for="false" class="ml-2 block text-sm text-gray-700">False</label>
          </div>
          <div class="flex items-center">
            <input 
              type="radio" 
              id="not_given" 
              name="correctAnswer" 
              value="not_given" 
              class="h-4 w-4 text-blue-600 border-gray-300 focus:ring-blue-500"
            >
            <label for="not_given" class="ml-2 block text-sm text-gray-700">Not Given</label>
          </div>
        </div>
      </div>

      <!-- Short Answer Options -->
      <div id="short_answerOptions" class="question-type-section mb-6 hidden">
        <h3 class="text-lg font-medium text-gray-900 mb-3">Set up short answer question</h3>
        
        <div class="mb-4">
          <label for="wordLimit" class="block text-sm font-medium text-gray-700 mb-1">Word limit</label>
          <div class="flex items-center">
            <input 
              type="number" 
              id="wordLimit" 
              name="wordLimit" 
              min="1" 
              value="2" 
              class="w-24 rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"
              required
            >
            <span class="ml-2 text-sm text-gray-500">words</span>
          </div>
          <p class="mt-1 text-sm text-gray-500">Maximum number of words allowed in the answer</p>
        </div>
        
        <div class="mb-4">
          <h4 class="text-md font-medium text-gray-800 mb-2">Acceptable answers</h4>
          <p class="text-sm text-gray-500 mb-3">Add all acceptable answers (case insensitive)</p>
          
          <div id="shortAnswerContainer" class="space-y-3">
            <div class="flex items-center gap-2 mb-2">
              <input type="text" name="acceptableShortAnswers" placeholder="Answer 1" class="flex-1 rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
              <button type="button" class="text-red-600 hover:text-red-900 remove-short-answer hidden">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                  <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
                </svg>
              </button>
            </div>
          </div>
          
          <button type="button" id="addShortAnswerBtn" class="mt-3 inline-flex items-center px-3 py-1.5 border border-transparent text-sm font-medium rounded-md text-blue-700 bg-blue-100 hover:bg-blue-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z" clip-rule="evenodd" />
            </svg>
            Add answer
          </button>
        </div>
        
        <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mt-4">
          <div class="flex">
            <div class="flex-shrink-0">
              <svg class="h-5 w-5 text-yellow-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
              </svg>
            </div>
            <div class="ml-3">
              <p class="text-sm text-yellow-700">
                Ensure that the answers do not exceed the word limit set.
              </p>
            </div>
          </div>
        </div>
      </div>

      <div class="flex justify-end">
        <button 
          type="submit" 
          id="createQuestionBtn"
          class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-md transition duration-200"
        >
          Create Question
        </button>
      </div>
    </form>
  </div>
</div>

<% scripts = `<script src="/js/admin/questions/create.js"></script>` %>